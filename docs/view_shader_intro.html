<html><head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8">
  <link rel="stylesheet" href="bootstrap.min.css">
  <link rel="stylesheet" href="main.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Mono&display=swap">
  <script src="https://kit.fontawesome.com/1e36e2dfe7.js" crossorigin="anonymous"></script>
  <script src="jquery.min.js"></script>
  <script src="bootstrap.min.js"></script>
  <script src="highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  <script src="fuse.min.js"></script>
  <script src="dox2web.js"></script>
  <title>Visionary Render Programming Guide: Writing View Shaders</title>
</head>
<body><a class="main-logo" href="https://www.virtalis.com" target="_blank" rel="noopener noreferrer"></a>
<nav class="navbar navbar-inverse navbar-fixed-top navbar-lower" role="navigation">
  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-nav-contents" aria-expanded="false">
    <span class="sr-only">Toggle navigation</span>
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
  </button>
  <div class="collapse navbar-collapse" id="bs-nav-contents"><ul class="nav navbar-nav" id="main-menu">
    <li><a href="index.html">Overview</a></li>
    <li><a href="pages.html">Contents</a></li>
    <li><a href="modules.html">API</a></li>
  </ul>
</nav>
<div class="shove"><div class="container-fluid"><div class="col-sm-10 col-sm-push-2 main"><nav aria-label = "breadcrumb"><ol class="breadcrumb forward-slash"><li class = "breadcrumb-item "><a href = "index.html">Overview</a></li><li class = "breadcrumb-item"><a href="advanced.html">Advanced Topics</a></li><li class = "breadcrumb-item active">Writing View Shaders</li></ol></nav><div class="page-toc"><ol><li><strong>Contents</strong></li><li><a href="#">Writing View Shaders</a></li><ol><li><a href="#i3rAybG0n7Tu">View Filter</a></li><li><a href="#zWfZ2vAeGouS">View Shader</a></li><ol><li><a href="#KGTyMO2FizHf">Built-in Variables and Functions</a></li><ol><li><a href="#s5pQu9k7zRCR">Variables</a></li><li><a href="#85JVeVGnkaxQ">Functions</a></li></ol><li><a href="#YxntVum5iYbX">Built-in View Shaders</a></li></ol></div><h1>Writing View Shaders</h1><p>A guide to writing filters that can be applied to the screen to perform specific rendering effects.</p><p>A View Filter can perform custom rendering effects on the final rendered image, using a View Shader to accomplish this.</p><p><h2 class="anchor" id="i3rAybG0n7Tu">View Filter</h2></p><p>These are filters which can be added to the scene to perform specific rendering effects to the final rendered image. There are a number of pre-configured filters built into Visionary Render.</p><p>A View Filter is a node that can be created and placed anywhere in the scene tree that, if enabled, will perform some kind of post-processing on the final image drawn into the viewport. In order to do this, it uses a View Shader. A newly created View Filter uses the default View Shader, which is a somple edge-detect algorithm which highlights edges. There are a number of pre-configured View Shaders built into Visionary Render.</p><p>This edge-detect shader is also used to indicate an error in your View Shader source code.</p><p><h2 class="anchor" id="zWfZ2vAeGouS">View Shader</h2></p><p>A View Shader is an assembly that can be created and placed only under a Library assembly, in the Developer tree. When referenced by a View Filter it executes its shader source code on every pixel in the final image drawn in the viewport. You can view and edit this shader source code by double-clicking on the View Shader in the tree.</p><p><img src="view_shader_create.png"></img></p><p>The View Shaders are written in OpenGL Shading Language (GLSL). It should take the following basic form:</p><p><div id="frag_7jqGH2u6IE3u"><ul class="nav nav-pills"><li class="active"><a href="#GLSL7jqGH2u6IE3u">GLSL</a></li></ul><div class="tab-content"><div id="GLSL7jqGH2u6IE3u" class="tab-pane active"><pre><code class="glsl">void mainImage(out vec4 fragColor, in vec2 fragCoord)
{
  fragColor = getColour();
}
</code></pre></div>
</div></div>
That shader would pass the current colour through unchanged. The main function must always be called 'mainImage' and it should always have those two parameters 'fragColor' and 'fragCoord'. The job of this function is to provide a colour (fragColor) at the specified pixel position (fragCoord). When the renderer automatically calls this function the 'fragCoord' parameter will contain the position of the pixel in viewport coordinates which has its origin at the lower-left (so 0,0 will be the lower-left of the viewport, while 1920,1080 would be the upper-right of the viewport if the viewports resolution was 1920x1080).</p><p>You could perform any kind of mathematics using only the pixel position to generate a colour, but its real use is if you know what the current colour of the pixel is. In order to find out what the current colour of the pixel is you need to call the 'getColour()' function, which returns a value of type 'vec4'. So, for example, to double the brightness of every pixel you could do the following:</p><p><div id="frag_1OMjybdhrSLB"><ul class="nav nav-pills"><li class="active"><a href="#GLSL1OMjybdhrSLB">GLSL</a></li></ul><div class="tab-content"><div id="GLSL1OMjybdhrSLB" class="tab-pane active"><pre><code class="glsl">void mainImage(out vec4 fragColor, in vec2 fragCoord)
{
  fragColor = getColour();
  fragColor += getColour(fragcoord.x+1.0, fragCoord.y);
  fragColor += getColour(fragcoord.x+1.0, fragCoord.y+1.0);
  fragColor += getColour(fragcoord.x, fragCoord.y+1.0);
  fragColor /= 4.0;
}
</code></pre></div>
</div></div>
At some point when writing these shaders you may think it would be useful to have a value that's tweakable in the user interface. Say in our brightness example we would like to allow the brightness factor to be controllable from within Visionary Render itself, whether through the user interface or via LUA script. We could do the following to allow this:</p><p><div id="frag_2XHv7CNpI5Gl"><ul class="nav nav-pills"><li class="active"><a href="#GLSL2XHv7CNpI5Gl">GLSL</a></li></ul><div class="tab-content"><div id="GLSL2XHv7CNpI5Gl" class="tab-pane active"><pre><code class="glsl">&lt;params&gt;
  &lt;MyTweakableBrightness type=&quot;float&quot; default=&quot;1.0&quot; /&gt;
&lt;/params&gt;

uniform float MyTweakableBrightness;

void mainImage(out vec4 fragColor, in vec2 fragCoord) 
{
  fragColor = getColour() * MyTweakableBrightness;
}
</code></pre></div>
</div></div>
Now when we use this shader in a View Filter the parameter 'MyTweakableBrightness' will be shown in that View Filters properties with the default value of 1.0 and can be changed.</p><p>NOTE: it will also be shown under the View Shader's properties, but the value under the View Filter will by default override that value, unless you uncheck the "Override" checkbox in the View Filter copy, or check the "Locked" checkbox in the View Shader's copy.</p><p>As you can see there's two parts to declaring one of these parameters in the shader source code - firstly we declare it as a GLSL uniform in the standard way (uniform just means a value that is set externally from somewhere else), then we use the <params> block to indicate to Visionary Render that it should expose this uniform in the tree for editing.</p><p><h3 class="anchor" id="KGTyMO2FizHf">Built-in Variables and Functions</h3></p><p>While writing view shaders you can use a number of built-in variables and functions that are automatically managed for you by the renderer. See some of the example shaders for how to use them.</p><p><h4 class="anchor" id="s5pQu9k7zRCR">Variables</h4></p><p><dl><dd><div class="table-responsive"><table class="table table-striped table-bordered"><thead><tr><th><p><strong>Variable</strong></p></th><th><p><strong>Description</strong></p></th></tr></thead><tbody><tr><td><p><strong>vec3 iResolution</strong></p></td><td><p>The viewport resolution (z is pixel aspect ratio, usually 1.0). </p></td></tr><tr><td><p><strong>float iGlobalTime</strong></p></td><td><p>Time since application started in seconds. </p></td></tr><tr><td><p><strong>vec2 iMouse</strong></p></td><td><p>Current pixel coordinates of the mouse cursor. </p></td></tr></tbody></table></div></dd></dl><h4 class="anchor" id="85JVeVGnkaxQ">Functions</h4></p><p><dl><dd><div class="table-responsive"><table class="table table-striped table-bordered"><thead><tr><th><p><strong>Function</strong></p></th><th><p><strong>Description</strong></p></th></tr></thead><tbody><tr><td><p><strong>vec4 getColour()</strong></p></td><td><p>Returns the RGBA colour at the current pixel position. </p></td></tr><tr><td><p><strong>vec4 getColour(float x, float y)</strong></p></td><td><p>Returns the RGBA colour at a specific pixel position. </p></td></tr><tr><td><p><strong>vec3 getEyePos()</strong></p></td><td><p>Returns the eye-space position at the current pixel position. </p></td></tr><tr><td><p><strong>vec3 getEyePos(float x, float y)</strong></p></td><td><p>Returns the eye-space position at a specific pixel position. </p></td></tr><tr><td><p><strong>vec3 getNormal()</strong></p></td><td><p>Returns the eye-space normal at the current pixel position. </p></td></tr><tr><td><p><strong>vec3 getNormal(float x, float y)</strong></p></td><td><p>Returns the eye-space normal at a specific pixel position. </p></td></tr><tr><td><p><strong>vec3 getWorldNormal()</strong></p></td><td><p>Returns the world-space normal at the current pixel position. </p></td></tr><tr><td><p><strong>vec3 getWorldNormal(float x, float y)</strong></p></td><td><p>Returns the world-space normal at a specific pixel position. </p></td></tr><tr><td><p><strong>float getDistance()</strong></p></td><td><p>Returns the distance in metres from the camera at the current pixel position. </p></td></tr><tr><td><p><strong>float getDistance(float x, float y)</strong></p></td><td><p>Returns the distance in metres from the camera at a specific pixel position. </p></td></tr><tr><td><p><strong>vec4 convolve3x3(vec2 fragCoord, float kernel[9])</strong></p></td><td><p>Returns the RGBA result of a 3x3 convolution filter passed in the 'kernel' parameter, around the coordinate 'fragCoord'. </p></td></tr></tbody></table></div></dd></dl><h3 class="anchor" id="YxntVum5iYbX">Built-in View Shaders</h3></p><p>There are a number of View Shaders built in to the Visionary Render installation. There now follows a brief description of each of them.</p><p><dl><dd><div class="table-responsive"><table class="table table-striped table-bordered"><thead><tr><th><p><strong>Name</strong></p></th><th><p><strong>Description</strong></p></th></tr></thead><tbody><tr><td><p><strong>Default</strong></p></td><td><p>This is the default filter setting, wobbles the image. </p></td></tr><tr><td><p><strong>Posterize</strong></p></td><td><p>Quantizes the red, green and blue components of the colour so they can be one of only 8 values, as opposed to being one of 256 values usually. This has the effect of looking like a poster printed using a very limited palette of ink. </p></td></tr><tr><td><p><strong>Depth of Field</strong></p></td><td><p>This adaptively blurs pixels depending on their distance from a focal plane. This distance is automatically set to be the distance of the pixel in the centre of the viewport, so anything drawn in the centre of the viewport will be sharp whereas everything else will be blurrier depending on how much closer or further away they are from this distance. This shader has a single tweakable parameter called 'maxblur', which dictates how large the blur kernel will be. </p></td></tr><tr><td><p><strong>Camera Motion Blur</strong></p></td><td><p>Adds motion blur to camera movement. Allows you to set the motion trail length, default is 2.0. </p></td></tr><tr><td><p><strong>FXAA</strong></p></td><td><p>Applies a fast, approximate anti-aliasing technique to reduce jagged edges </p></td></tr><tr><td><p><strong>Wobbly</strong></p></td><td><p>Offsets the pixels horizontally in a wave pattern </p></td></tr><tr><td><p><strong>Show Normals</strong></p></td><td><p>Shows the world-space normal vectors as colours around the mouse position. Allows you to set the radius from the cursor in pixels. </p></td></tr><tr><td><p><strong>Torch</strong></p></td><td><p>Places a point light 1cm above the surface under the mouse. The Distance and luminance can be set using the height and luminance metadata values. </p></td></tr><tr><td><p><strong>Edge Detect</strong></p></td><td><p>Simple Laplacian edge detect convolution. </p></td></tr><tr><td><p><strong>White Edge</strong></p></td><td><p>Laplacian edges detected and drawn in white. </p></td></tr><tr><td><p><strong>Red Edge Overlay</strong></p></td><td><p>Laplacian edges detected and drawn in red. </p></td></tr><tr><td><p><strong>Sobel</strong></p></td><td><p>Sobel operator. </p></td></tr><tr><td><p><strong>Silhouette</strong></p></td><td><p>Draws a white silhouette around everything drawn against the clear background. </p></td></tr></tbody></table></div></dd></dl>
Multiple filters can be combined together to form different effects. </p><hr/><div class="row footer-nav footer-links"><div class="col-sm-4"><p><span class="fas fa-arrow-circle-left" aria-hidden="true"></span>&nbsp;<a href="surface_shader_intro.html">Writing Surface Shaders</a></p></div><div class="col-sm-4 col-sm-offset-4"><p class="pull-right"><a href="changes.html">Changelog</a>&nbsp;<span class="fas fa-arrow-circle-right" aria-hidden="true"></span></p></div></div></div><div class="col-sm-2 col-sm-pull-10 "><div class="main-search"><form id="docs-search" autocomplete="off" class="form-horizontal" accept-charset="utf-8"><div class="input-group text-border"><input name="srch-term" id="srch-term" class="form-control" type="text" placeholder="Search"></div></form></div><div id="searchResults"><div class="list-group"><p class="list-group-item">No Results.</p></div></div><div class="list-group list-group-root"><span class="list-group-item"><a href="#side_getting_started" data-toggle="collapse"><i class="fas fa-plus-square list-toggle"></i></a><a href="getting_started.html">Getting Started</a></span><div class="list-group collapse" id="side_getting_started"><span class="list-group-item"><a href="applua_intro.html">Using the Script Editor</a></span><span class="list-group-item"><a href="eventlua_intro.html">Using the Script Event System</a></span><span class="list-group-item"><a href="luaplugin_intro.html">Creating a Lua Plugin</a></span><span class="list-group-item"><a href="plugin_intro.html">Creating a Native Plugin</a></span><span class="list-group-item"><a href="plugin_wrangle_api.html">Accessing the API</a></span></div><span class="list-group-item"><a href="#side_architecture" data-toggle="collapse"><i class="fas fa-plus-square list-toggle"></i></a><a href="architecture.html">Architecture</a></span><div class="list-group collapse" id="side_architecture"><span class="list-group-item"><a href="api_diagram.html">API Diagram</a></span><span class="list-group-item"><a href="metanodes.html">Metanodes</a></span><span class="list-group-item"><a href="properties.html">Properties</a></span><span class="list-group-item"><a href="nodes.html">Nodes</a></span><span class="list-group-item"><a href="observers.html">Observers</a></span><span class="list-group-item"><a href="scenegraph.html">Scene Graph</a></span><span class="list-group-item"><a href="plugin_directories.html">Plugin Search Paths</a></span></div><span class="list-group-item"><a href="best_practices.html">Best Practices</a></span><span class="list-group-item"><a href="#side_howto" data-toggle="collapse"><i class="fas fa-plus-square list-toggle"></i></a><a href="howto.html">How To</a></span><div class="list-group collapse" id="side_howto"><span class="list-group-item"><a href="#side_howto_lua" data-toggle="collapse"><i class="fas fa-plus-square list-toggle"></i></a><a href="howto_lua.html">Scripts</a></span><div class="list-group collapse" id="side_howto_lua"><span class="list-group-item"><a href="lua_assembly_howto.html">Work with Assembly Nodes</a></span><span class="list-group-item"><a href="lua_visual_howto.html">Work with Visual Nodes</a></span><span class="list-group-item"><a href="lua_light_howto.html">Work with Light Nodes</a></span><span class="list-group-item"><a href="lua_material_howto.html">Work with Material Nodes</a></span><span class="list-group-item"><a href="lua_lodgeo_howto.html">Work with Level of Detail and GeoGroup Nodes</a></span><span class="list-group-item"><a href="lua_sequence_howto.html">Work with Sequence Nodes</a></span><span class="list-group-item"><a href="lua_audio_howto.html">Work with Audio Nodes</a></span><span class="list-group-item"><a href="lua_video_howto.html">Work with Movie Nodes</a></span><span class="list-group-item"><a href="lua_metadata_howto.html">Work with Metadata and Attribute Nodes</a></span><span class="list-group-item"><a href="lua_settings_howto.html">Work with Settings Nodes</a></span><span class="list-group-item"><a href="lua_observers_howto.html">Work with Observers</a></span></div><span class="list-group-item"><a href="#side_howto_plugins" data-toggle="collapse"><i class="fas fa-plus-square list-toggle"></i></a><a href="howto_plugins.html">Plugins</a></span><div class="list-group collapse" id="side_howto_plugins"><span class="list-group-item"><a href="importer_howto.html">Provide a Data Importer</a></span><span class="list-group-item"><a href="exporter_howto.html">Provide a Data Exporter</a></span><span class="list-group-item"><a href="context_menu_howto.html">Add a Context Menu</a></span><span class="list-group-item"><a href="ffi_howto.html">Use the Foreign Function Interface (FFI)</a></span><span class="list-group-item"><a href="luafunc_howto.html">Provide a Lua Function</a></span><span class="list-group-item"><a href="define_metanode_howto.html">Define a Custom MetaNode</a></span><span class="list-group-item"><a href="update_howto.html">Implement an Update Function</a></span><span class="list-group-item"><a href="observer_howto.html">Implement an Observer</a></span><span class="list-group-item"><a href="logging_howto.html">Write to the Application Log</a></span><span class="list-group-item"><a href="dialog_howto.html">Present a Modal Dialog</a></span><span class="list-group-item"><a href="progress_howto.html">Update the Loading Screen</a></span></div></div><span class="list-group-item show-path"><a href="#side_advanced" data-toggle="collapse"><i class="fas fa-minus-square list-toggle"></i></a><a href="advanced.html">Advanced Topics</a></span><div class="list-group collapse in" id="side_advanced"><span class="list-group-item"><a href="advanced_appcommands.html">Application Commands</a></span><span class="list-group-item"><a href="advanced_semantics.html">Semantics</a></span><span class="list-group-item"><a href="advanced_metanode_versioning.html">Metanode Versioning</a></span><span class="list-group-item"><a href="dynamic_loading.html">Enabling/Disabling Plugins at Runtime</a></span><span class="list-group-item"><a href="lua_coroutines.html">Coroutines in Lua Plugins</a></span><span class="list-group-item"><a href="lua_odbc.html">Using LuaSQL for ODBC Connections</a></span><span class="list-group-item"><a href="lua_com.html">Reference External Data Using the COM</a></span><span class="list-group-item"><a href="terminating_long_scripts.html">Terminating Long Scripts</a></span><span class="list-group-item"><a href="plugin_depends.html">Plugin Dependencies</a></span><span class="list-group-item"><a href="surface_shader_intro.html">Writing Surface Shaders</a></span><span class="list-group-item show-path"><a href="view_shader_intro.html">Writing View Shaders</a></span></div><span class="list-group-item"><a href="#side_changes" data-toggle="collapse"><i class="fas fa-plus-square list-toggle"></i></a><a href="changes.html">Changelog</a></span><div class="list-group collapse" id="side_changes"><span class="list-group-item"><a href="v2023_2_to_v2024_1.html">New in 2024.1</a></span><span class="list-group-item"><a href="v2023_1_to_v2023_2.html">New in 2023.2</a></span><span class="list-group-item"><a href="v2021_2_to_v2021_3.html">New in 2021.3</a></span><span class="list-group-item"><a href="v2021_1_to_v2021_2.html">New in 2021.2</a></span><span class="list-group-item"><a href="v2020_2_to_v2021_1.html">New in 2021.1</a></span><span class="list-group-item"><a href="v2020_1_to_v2020_2.html">New in 2020.2</a></span><span class="list-group-item"><a href="v2019_3_to_v2020_1.html">New in 2020.1</a></span><span class="list-group-item"><a href="v2019_2_to_v2019_3.html">New in 2019.3</a></span><span class="list-group-item"><a href="v22_to_v2019_2.html">New in 2019.2</a></span><span class="list-group-item"><a href="v21_to_v22.html">New in 2.2.0</a></span><span class="list-group-item"><a href="v20_to_v21.html">New in 2.1.0</a></span><span class="list-group-item"><a href="#side_v13x_to_v2" data-toggle="collapse"><i class="fas fa-plus-square list-toggle"></i></a><a href="v13x_to_v2.html">New in 2.0.0</a></span><div class="list-group collapse" id="side_v13x_to_v2"><span class="list-group-item"><a href="v13x_200_pivots.html">Pivot API Changes</a></span><span class="list-group-item"><a href="v13x_200_lua_co.html">Lua Event Coroutines</a></span><span class="list-group-item"><a href="v13x_200_lua_observers.html">Lua Observers</a></span></div></div><span class="list-group-item"><a href="namespacevrtree.html">vrtree</a></span><span class="list-group-item"><a href="namespacevrtree__cpp.html">vrtree_cpp</a></span><span class="list-group-item"><a href="namespacevt_core.html">vtCore</a></span><span class="list-group-item"><a href="group__api__core.html">Core</a></span><span class="list-group-item"><a href="group__api__ffi.html">Foreign Function Interface</a></span><span class="list-group-item"><a href="#side_group__api__metanodes" data-toggle="collapse"><i class="fas fa-plus-square list-toggle"></i></a><a href="group__api__metanodes.html">Metanodes</a></span><div class="list-group collapse" id="side_group__api__metanodes"><span class="list-group-item"><a href="group__api__metanodes__general.html">General</a></span><span class="list-group-item"><a href="group__api__metanodes__properties.html">Properties</a></span><span class="list-group-item"><a href="group__api__metanodes__semantics.html">Semantics and Hints</a></span><span class="list-group-item"><a href="group__api__metadefs.html">Metanode Structure Definitions</a></span></div><span class="list-group-item"><a href="group__api__migrations.html">Migrations</a></span><span class="list-group-item"><a href="group__api__observer.html">Observers</a></span><span class="list-group-item"><a href="group__api__properties.html">Properties</a></span><span class="list-group-item"><a href="group__api__settings.html">Settings</a></span><span class="list-group-item"><a href="group__api__tree.html">Tree</a></span><span class="list-group-item"><a href="group__api__utils.html">Utilities</a></span><span class="list-group-item"><a href="#side_group__api__defs" data-toggle="collapse"><i class="fas fa-plus-square list-toggle"></i></a><a href="group__api__defs.html">API Definitions</a></span><div class="list-group collapse" id="side_group__api__defs"><span class="list-group-item"><a href="group__api__types.html">Types</a></span><span class="list-group-item"><a href="group__api__proto.html">Function Prototypes</a></span><span class="list-group-item"><a href="group__api__flags.html">Flags</a></span><span class="list-group-item"><a href="group__api__io__flags.html">Save/Load Tree I/O Flags</a></span><span class="list-group-item"><a href="group__api__builder__flags.html">Build Filter flags</a></span><span class="list-group-item"><a href="group__api__loggingmask.html">Logging masks</a></span><span class="list-group-item"><a href="group__api__errors.html">Error codes</a></span></div><span class="list-group-item"><a href="group__api__exchange.html">VR Exchange</a></span><span class="list-group-item"><a href="#side_group__api__plugins" data-toggle="collapse"><i class="fas fa-plus-square list-toggle"></i></a><a href="group__api__plugins.html">Plugins</a></span><div class="list-group collapse" id="side_group__api__plugins"><span class="list-group-item"><a href="group__api__plugin__interface.html">Plugin Interface</a></span><span class="list-group-item"><a href="group__api__plugin__utils.html">Plugin Utilities</a></span></div><span class="list-group-item"><a href="group__api__lua.html">Lua API</a></span></div></div>
</div></div></body></html>