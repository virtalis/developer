<html><head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8">
  <link rel="stylesheet" href="bootstrap.min.css">
  <link rel="stylesheet" href="main.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Mono&display=swap">
  <script src="https://kit.fontawesome.com/1e36e2dfe7.js" crossorigin="anonymous"></script>
  <script src="jquery.min.js"></script>
  <script src="bootstrap.min.js"></script>
  <script src="highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  <script src="fuse.min.js"></script>
  <script src="dox2web.js"></script>
  <title>Visionary Render Programming Guide: Creating a Lua Plugin</title>
</head>
<body><a class="main-logo" href="https://www.virtalis.com" target="_blank" rel="noopener noreferrer"></a>
<nav class="navbar navbar-inverse navbar-fixed-top navbar-lower" role="navigation">
  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-nav-contents" aria-expanded="false">
    <span class="sr-only">Toggle navigation</span>
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
  </button>
  <div class="collapse navbar-collapse" id="bs-nav-contents"><ul class="nav navbar-nav" id="main-menu">
    <li><a href="index.html">Overview</a></li>
    <li><a href="pages.html">Contents</a></li>
    <li><a href="modules.html">API</a></li>
  </ul>
</nav>
<div class="shove"><div class="container-fluid"><div class="col-sm-10 col-sm-push-2 main"><nav aria-label = "breadcrumb"><ol class="breadcrumb forward-slash"><li class = "breadcrumb-item "><a href = "index.html">Overview</a></li><li class = "breadcrumb-item"><a href="getting_started.html">Getting Started</a></li><li class = "breadcrumb-item active">Creating a Lua Plugin</li></ol></nav><div class="page-toc"><ol><li><strong>Contents</strong></li><li><a href="#">Creating a Lua Plugin</a></li><ol><li><a href="#1VcOBCR8fHUP">Modules</a></li><li><a href="#TBZLhE7mcNpl">Plugins</a></li><ol><li><a href="#ZZQG5S0KbJ2w">Example Code</a></li><li><a href="#Wwv5wl9bJCiV">Usage</a></li></ol></div><h1>Creating a Lua Plugin</h1><p>This page gives an introduction to creating Lua plugins.</p><p><h2 class="anchor" id="1VcOBCR8fHUP">Modules</h2></p><p>A module is a container for related functionality that can be 'required' (i.e. included) by other Lua scripts. There are various ways to implement a module in Lua. For Visionary Render plugins, any method can be used. For an overview of these methods, see the <a href="http://lua-users.org/wiki/ModulesTutorial">Modules Tutorial</a> section of the Lua website.</p><p>Older modules used the <code>module</code> method where code had no direct access to global variables. Instead the author had to localise them before calling <code>module</code> (e.g. <code>local print = print</code>). This tends to make developing a module more difficult. Our new recommended way to develop Lua modules is to make everything inside the module <code>local</code>, and explicitly expose the functions that should be available to the user of the module. This is demonstrated as part of the Lua plugin example code below.</p><p><h2 class="anchor" id="TBZLhE7mcNpl">Plugins</h2></p><p>A Lua plugin in Visionary Render has full access to everything that a normal event script does - i.e. the full <a href="group__api__lua.html" title="Functions and types available to Lua plugins and the Visionary Render events system / script console">Lua API</a>. To instruct Visionary Render to load a Lua plugin, the quickest way is to put the <code>.lua</code> file in <code>Documents/Visionary Render/plugins/&lt;lua file name&gt;/&lt;lua file name&gt;.lua</code> (e.g. <code>plugins/myplugin/myplugin.lua</code>). A Lua plugin requires the following functions to permit it to be loaded by the plugin manager in Visionary Render:</p><p><dl><dd><div class="table-responsive"><table class="table table-striped table-bordered"><thead><tr><th><p>Function </p></th><th><p>Description  </p></th></tr></thead><tbody><tr><td><p><code>name()</code></p></td><td><p>This should return a human-readable name for this plugin to be used to display this plugin in the plugin manager settings. </p></td></tr><tr><td><p><code>version()</code></p></td><td><p>This should return the version number, which is also used in the plugin manager settings. </p></td></tr><tr><td><p><code>init()</code></p></td><td><p>This is called once when the plugin is loaded, and should initialise any necessary objects such as VRTree nodes or menu items, etc. </p></td></tr><tr><td><p><code>cleanup()</code></p></td><td><p>This is called once when the plugin is unloaded, and should delete anything that <code>init()</code> added to VRTree. See <a href="dynamic_loading.html" title="">Enabling/Disabling Plugins at Runtime</a> for more information. (Optional) </p></td></tr></tbody></table></div></dd></dl><h3 class="anchor" id="ZZQG5S0KbJ2w">Example Code</h3></p><p>The following example shows how to create a simple plugin:</p><p><div id="frag_hYiAyPir1TbW"><ul class="nav nav-pills"><li class="active"><a href="#myplugin.luahYiAyPir1TbW">myplugin.lua</a></li></ul><div class="tab-content"><div id="myplugin.luahYiAyPir1TbW" class="tab-pane active"><pre><code>local function name()
  -- Return the name of the plugin.
  return &quot;My Plugin&quot;
end

local function version()
  -- Return the version number of the plugin.
  return &quot;1.0.0&quot;
end

local function init()
  -- Do something to initialise the plugin here...
  print(&quot;Init &quot;, name())
end

local function cleanup()
  -- Do something to clean up the plugin here...
  print(&quot;Cleanup &quot;, name())
end

-- Export the plugin functions to the Lua state.
return {
  name = name,
  version = version,
  init = init,
  cleanup = cleanup
}
</code></pre></div>
</div></div><div class="alert alert-warning"><p><strong>Caution</strong></p><p><p>You should define the functions in your plugin as local to prevent possible clashes with other plugins or API functions.</p></p></div>
This will result in a <code>myplugin</code> table in the global Lua state (named after the plugin file name), containing the four functions we exported. To test the plugin, save it in the location mentioned above, and Launch Visionary Render. Open the Diagnostics window (<code>Ctrl</code> + <code>D</code>), go to the Log tab, and somewhere in here should be the line <code>{LUA} Init My Plugin</code> - this is the output from your first plugin. You can also see this in the lower pane of the Script Editor (<code>Ctrl</code> + <code>L</code>).</p><p>It is important to only define functions and local variables in the plugin script files, and not to execute any code outside of these functions. This is because, when loading the plugin, it is first loaded into a separate sandbox for querying its name and version, in order to check for conflicts with other plugins before exposing it to the main application Lua environment. This sandbox does not have access to any VR Lua functions or anything else in the main application environment.</p><p><h3 class="anchor" id="Wwv5wl9bJCiV">Usage</h3></p><p>Any functions exported by the plugin can be accessed in Visionary Render via an Event script or the Console. For example, run the following in the Console:</p><p><div id="frag_SD1MQ3xYljgX"><ul class="nav nav-pills"><li class="active"><a href="#ConsoleSD1MQ3xYljgX">Console</a></li><li><a href="#OutputSD1MQ3xYljgX">Output</a></li></ul><div class="tab-content"><div id="ConsoleSD1MQ3xYljgX" class="tab-pane active"><pre><code>-- Print the name of myplugin to the Output panel.
print(myplugin.name())
</code></pre></div>
<div id="OutputSD1MQ3xYljgX" class="tab-pane"><pre><code>{LUA} My Plugin
</code></pre></div>
</div></div></p><hr/><div class="row footer-nav footer-links"><div class="col-sm-4"><p><span class="fas fa-arrow-circle-left" aria-hidden="true"></span>&nbsp;<a href="eventlua_intro.html">Using the Script Event System</a></p></div><div class="col-sm-4 col-sm-offset-4"><p class="pull-right"><a href="plugin_intro.html">Creating a Native Plugin</a>&nbsp;<span class="fas fa-arrow-circle-right" aria-hidden="true"></span></p></div></div></div><div class="col-sm-2 col-sm-pull-10 "><div class="main-search"><form id="docs-search" autocomplete="off" class="form-horizontal" accept-charset="utf-8"><div class="input-group text-border"><input name="srch-term" id="srch-term" class="form-control" type="text" placeholder="Search"></div></form></div><div id="searchResults"><div class="list-group"><p class="list-group-item">No Results.</p></div></div><div class="list-group list-group-root"><span class="list-group-item show-path"><a href="#side_getting_started" data-toggle="collapse"><i class="fas fa-minus-square list-toggle"></i></a><a href="getting_started.html">Getting Started</a></span><div class="list-group collapse in" id="side_getting_started"><span class="list-group-item"><a href="applua_intro.html">Using the Script Editor</a></span><span class="list-group-item"><a href="eventlua_intro.html">Using the Script Event System</a></span><span class="list-group-item show-path"><a href="luaplugin_intro.html">Creating a Lua Plugin</a></span><span class="list-group-item"><a href="plugin_intro.html">Creating a Native Plugin</a></span><span class="list-group-item"><a href="plugin_wrangle_api.html">Accessing the API</a></span></div><span class="list-group-item"><a href="#side_architecture" data-toggle="collapse"><i class="fas fa-plus-square list-toggle"></i></a><a href="architecture.html">Architecture</a></span><div class="list-group collapse" id="side_architecture"><span class="list-group-item"><a href="api_diagram.html">API Diagram</a></span><span class="list-group-item"><a href="metanodes.html">Metanodes</a></span><span class="list-group-item"><a href="properties.html">Properties</a></span><span class="list-group-item"><a href="nodes.html">Nodes</a></span><span class="list-group-item"><a href="observers.html">Observers</a></span><span class="list-group-item"><a href="scenegraph.html">Scene Graph</a></span><span class="list-group-item"><a href="plugin_directories.html">Plugin Search Paths</a></span></div><span class="list-group-item"><a href="best_practices.html">Best Practices</a></span><span class="list-group-item"><a href="#side_howto" data-toggle="collapse"><i class="fas fa-plus-square list-toggle"></i></a><a href="howto.html">How To</a></span><div class="list-group collapse" id="side_howto"><span class="list-group-item"><a href="#side_howto_lua" data-toggle="collapse"><i class="fas fa-plus-square list-toggle"></i></a><a href="howto_lua.html">Scripts</a></span><div class="list-group collapse" id="side_howto_lua"><span class="list-group-item"><a href="lua_assembly_howto.html">Work with Assembly Nodes</a></span><span class="list-group-item"><a href="lua_visual_howto.html">Work with Visual Nodes</a></span><span class="list-group-item"><a href="lua_light_howto.html">Work with Light Nodes</a></span><span class="list-group-item"><a href="lua_material_howto.html">Work with Material Nodes</a></span><span class="list-group-item"><a href="lua_lodgeo_howto.html">Work with Level of Detail and GeoGroup Nodes</a></span><span class="list-group-item"><a href="lua_sequence_howto.html">Work with Sequence Nodes</a></span><span class="list-group-item"><a href="lua_audio_howto.html">Work with Audio Nodes</a></span><span class="list-group-item"><a href="lua_video_howto.html">Work with Movie Nodes</a></span><span class="list-group-item"><a href="lua_metadata_howto.html">Work with Metadata and Attribute Nodes</a></span><span class="list-group-item"><a href="lua_settings_howto.html">Work with Settings Nodes</a></span><span class="list-group-item"><a href="lua_observers_howto.html">Work with Observers</a></span></div><span class="list-group-item"><a href="#side_howto_plugins" data-toggle="collapse"><i class="fas fa-plus-square list-toggle"></i></a><a href="howto_plugins.html">Plugins</a></span><div class="list-group collapse" id="side_howto_plugins"><span class="list-group-item"><a href="importer_howto.html">Provide a Data Importer</a></span><span class="list-group-item"><a href="exporter_howto.html">Provide a Data Exporter</a></span><span class="list-group-item"><a href="context_menu_howto.html">Add a Context Menu</a></span><span class="list-group-item"><a href="ffi_howto.html">Use the Foreign Function Interface (FFI)</a></span><span class="list-group-item"><a href="luafunc_howto.html">Provide a Lua Function</a></span><span class="list-group-item"><a href="define_metanode_howto.html">Define a Custom MetaNode</a></span><span class="list-group-item"><a href="update_howto.html">Implement an Update Function</a></span><span class="list-group-item"><a href="observer_howto.html">Implement an Observer</a></span><span class="list-group-item"><a href="logging_howto.html">Write to the Application Log</a></span><span class="list-group-item"><a href="dialog_howto.html">Present a Modal Dialog</a></span><span class="list-group-item"><a href="progress_howto.html">Update the Loading Screen</a></span></div></div><span class="list-group-item"><a href="#side_advanced" data-toggle="collapse"><i class="fas fa-plus-square list-toggle"></i></a><a href="advanced.html">Advanced Topics</a></span><div class="list-group collapse" id="side_advanced"><span class="list-group-item"><a href="advanced_appcommands.html">Application Commands</a></span><span class="list-group-item"><a href="advanced_semantics.html">Semantics</a></span><span class="list-group-item"><a href="advanced_metanode_versioning.html">Metanode Versioning</a></span><span class="list-group-item"><a href="dynamic_loading.html">Enabling/Disabling Plugins at Runtime</a></span><span class="list-group-item"><a href="lua_coroutines.html">Coroutines in Lua Plugins</a></span><span class="list-group-item"><a href="lua_odbc.html">Using LuaSQL for ODBC Connections</a></span><span class="list-group-item"><a href="lua_com.html">Reference External Data Using the COM</a></span><span class="list-group-item"><a href="terminating_long_scripts.html">Terminating Long Scripts</a></span><span class="list-group-item"><a href="plugin_depends.html">Plugin Dependencies</a></span><span class="list-group-item"><a href="surface_shader_intro.html">Writing Surface Shaders</a></span><span class="list-group-item"><a href="view_shader_intro.html">Writing View Shaders</a></span></div><span class="list-group-item"><a href="#side_changes" data-toggle="collapse"><i class="fas fa-plus-square list-toggle"></i></a><a href="changes.html">Changelog</a></span><div class="list-group collapse" id="side_changes"><span class="list-group-item"><a href="v2023_2_to_v2024_1.html">New in 2024.1</a></span><span class="list-group-item"><a href="v2023_1_to_v2023_2.html">New in 2023.2</a></span><span class="list-group-item"><a href="v2021_2_to_v2021_3.html">New in 2021.3</a></span><span class="list-group-item"><a href="v2021_1_to_v2021_2.html">New in 2021.2</a></span><span class="list-group-item"><a href="v2020_2_to_v2021_1.html">New in 2021.1</a></span><span class="list-group-item"><a href="v2020_1_to_v2020_2.html">New in 2020.2</a></span><span class="list-group-item"><a href="v2019_3_to_v2020_1.html">New in 2020.1</a></span><span class="list-group-item"><a href="v2019_2_to_v2019_3.html">New in 2019.3</a></span><span class="list-group-item"><a href="v22_to_v2019_2.html">New in 2019.2</a></span><span class="list-group-item"><a href="v21_to_v22.html">New in 2.2.0</a></span><span class="list-group-item"><a href="v20_to_v21.html">New in 2.1.0</a></span><span class="list-group-item"><a href="#side_v13x_to_v2" data-toggle="collapse"><i class="fas fa-plus-square list-toggle"></i></a><a href="v13x_to_v2.html">New in 2.0.0</a></span><div class="list-group collapse" id="side_v13x_to_v2"><span class="list-group-item"><a href="v13x_200_pivots.html">Pivot API Changes</a></span><span class="list-group-item"><a href="v13x_200_lua_co.html">Lua Event Coroutines</a></span><span class="list-group-item"><a href="v13x_200_lua_observers.html">Lua Observers</a></span></div></div><span class="list-group-item"><a href="namespacevrtree.html">vrtree</a></span><span class="list-group-item"><a href="namespacevrtree__cpp.html">vrtree_cpp</a></span><span class="list-group-item"><a href="namespacevt_core.html">vtCore</a></span><span class="list-group-item"><a href="group__api__core.html">Core</a></span><span class="list-group-item"><a href="group__api__ffi.html">Foreign Function Interface</a></span><span class="list-group-item"><a href="#side_group__api__metanodes" data-toggle="collapse"><i class="fas fa-plus-square list-toggle"></i></a><a href="group__api__metanodes.html">Metanodes</a></span><div class="list-group collapse" id="side_group__api__metanodes"><span class="list-group-item"><a href="group__api__metanodes__general.html">General</a></span><span class="list-group-item"><a href="group__api__metanodes__properties.html">Properties</a></span><span class="list-group-item"><a href="group__api__metanodes__semantics.html">Semantics and Hints</a></span><span class="list-group-item"><a href="group__api__metadefs.html">Metanode Structure Definitions</a></span></div><span class="list-group-item"><a href="group__api__migrations.html">Migrations</a></span><span class="list-group-item"><a href="group__api__observer.html">Observers</a></span><span class="list-group-item"><a href="group__api__properties.html">Properties</a></span><span class="list-group-item"><a href="group__api__settings.html">Settings</a></span><span class="list-group-item"><a href="group__api__tree.html">Tree</a></span><span class="list-group-item"><a href="group__api__utils.html">Utilities</a></span><span class="list-group-item"><a href="#side_group__api__defs" data-toggle="collapse"><i class="fas fa-plus-square list-toggle"></i></a><a href="group__api__defs.html">API Definitions</a></span><div class="list-group collapse" id="side_group__api__defs"><span class="list-group-item"><a href="group__api__types.html">Types</a></span><span class="list-group-item"><a href="group__api__proto.html">Function Prototypes</a></span><span class="list-group-item"><a href="group__api__flags.html">Flags</a></span><span class="list-group-item"><a href="group__api__io__flags.html">Save/Load Tree I/O Flags</a></span><span class="list-group-item"><a href="group__api__builder__flags.html">Build Filter flags</a></span><span class="list-group-item"><a href="group__api__loggingmask.html">Logging masks</a></span><span class="list-group-item"><a href="group__api__errors.html">Error codes</a></span></div><span class="list-group-item"><a href="group__api__exchange.html">VR Exchange</a></span><span class="list-group-item"><a href="#side_group__api__plugins" data-toggle="collapse"><i class="fas fa-plus-square list-toggle"></i></a><a href="group__api__plugins.html">Plugins</a></span><div class="list-group collapse" id="side_group__api__plugins"><span class="list-group-item"><a href="group__api__plugin__interface.html">Plugin Interface</a></span><span class="list-group-item"><a href="group__api__plugin__utils.html">Plugin Utilities</a></span></div><span class="list-group-item"><a href="group__api__lua.html">Lua API</a></span></div></div>
</div></div></body></html>