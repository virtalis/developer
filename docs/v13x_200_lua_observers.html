<html><head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8">
  <link rel="stylesheet" href="bootstrap.min.css">
  <link rel="stylesheet" href="main.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Mono&display=swap">
  <script src="https://kit.fontawesome.com/1e36e2dfe7.js" crossorigin="anonymous"></script>
  <script src="jquery.min.js"></script>
  <script src="bootstrap.min.js"></script>
  <script src="highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  <script src="fuse.min.js"></script>
  <script src="dox2web.js"></script>
  <title>Visionary Render Programming Guide: Lua Observers</title>
</head>
<body><a class="main-logo" href="https://www.virtalis.com" target="_blank" rel="noopener noreferrer"></a>
<nav class="navbar navbar-inverse navbar-fixed-top navbar-lower" role="navigation">
  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-nav-contents" aria-expanded="false">
    <span class="sr-only">Toggle navigation</span>
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
  </button>
  <div class="collapse navbar-collapse" id="bs-nav-contents"><ul class="nav navbar-nav" id="main-menu">
    <li><a href="index.html">Overview</a></li>
    <li><a href="pages.html">Contents</a></li>
    <li><a href="modules.html">API</a></li>
  </ul>
</nav>
<div class="shove"><div class="container-fluid"><div class="col-sm-10 col-sm-push-2 main"><nav aria-label = "breadcrumb"><ol class="breadcrumb forward-slash"><li class = "breadcrumb-item "><a href = "index.html">Overview</a></li><li class = "breadcrumb-item"><a href="changes.html">Changelog</a></li><li class = "breadcrumb-item"><a href="v13x_to_v2.html">New in 2.0.0</a></li><li class = "breadcrumb-item active">Lua Observers</li></ol></nav><div class="page-toc"><ol><li><strong>Contents</strong></li><li><a href="#">Lua Observers</a></li><ol><li><a href="#cQeCUedXzA8F">Transform Node Observer</a></li><ol><li><a href="#I4lZDgsWzhlE">Difference from property observer</a></li><li><a href="#OtcaAdRqMDCY">Example</a></li></ol><li><a href="#ImwtbrL0nDpU">Changes to Node and MetaNode Observers</a></li><ol><li><a href="#P72WXMdEo3Ev">Node Observer</a></li><li><a href="#X7fWeKNS8wmL">MetaNode Observer</a></li></ol></div><h1>Lua Observers</h1><p>New Lua observers and additional callbacks for existing observers.</p><p><h2 class="anchor" id="cQeCUedXzA8F">Transform Node Observer</h2></p><p>There is a new type of observer that can be registered from Lua, which observes changes in internal scenegraph nodes dealing with world and local transforms, as well as world and local enabled states.</p><p><h3 class="anchor" id="I4lZDgsWzhlE">Difference from property observer</h3></p><p>A transform observer differs from a normal property observer because it only observes the <code>Enabled</code> and <code>Transform</code> properties, and is also notified in response to changes of state on any ancestor of the node being observed.</p><p>When an assembly node is disabled, all of its descendants are also considered to be disabled in terms of application systems traversing the tree to process child nodes. However, a normal property observer on an <code>Enabled</code> property of one of these descendants would not be notified of this change because the property of that node hasn't actually changed.</p><p>Equally when an assembly node is moved, all of its descendants world transform change due to the nature of the transform hierarchy. A property observer on a <code>Transform</code> property of one of these descendants would not be notified of this change because the local transforms on these assemblies does not actually change when an ancestor transform changes.</p><p>This is the problem solved by the transform node observer.</p><p><h3 class="anchor" id="OtcaAdRqMDCY">Example</h3></p><p>A transform observer is added using the <a href="group__api__lua.html#1ga8fe6bbf12d7a73923de10c30a01b8340" title="Add an observer to the SGNode of a vrtree node">vrAddTransformNodeObserver</a> function.</p><p>Consider this hierarchy of assembly nodes in the Scenes tree: <pre><code>Scenes
 - A
   - B
     - C
</code></pre>
</p><p>The following code snippet, executed in the console, will add a transform observer to the <code>C</code> assembly node, providing callback functions for transform and enabled state changes that print out a message that show the state notification was successful.</p><p><div id="frag_ljowfByvDZWh"><ul class="nav nav-pills"><li class="active"><a href="#LualjowfByvDZWh">Lua</a></li></ul><div class="tab-content"><div id="LualjowfByvDZWh" class="tab-pane active"><pre><code class="lua">vrAddTransformNodeObserver(&quot;myObserver&quot;, 
  function(node, matrix) print(&quot;transform changed&quot;) end,
  function(node, enabled) print(&quot;enabled state changed&quot;) end,
  vrTreeRoot().Scenes.A.B.C
)
</code></pre></div>
</div></div>
After running this example code, changing the transform or enabled property of any of <code>A</code>, <code>B</code>, or <code>C</code> will trigger the print messages.</p><p>The observer can also be removed using the <a href="group__api__lua.html#1gae6e7242786fac62ef57c146fd0713d9e" title="Removes an observer">vrRemoveObserver</a> function, by providing the name (in this case "myObserver").</p><p><h2 class="anchor" id="ImwtbrL0nDpU">Changes to Node and MetaNode Observers</h2></p><p><a href="group__api__lua.html#1gad485b003fd03b3cbf6296606f75db719" title="Adds an observer of events from a node">vrAddNodeObserver</a> and <a href="group__api__lua.html#1ga25c3e2a2ab0bce779062726c20a15efd" title="Adds an observer of events from a MetaNode">vrAddMetaNodeObserver</a> have been extended to support additional callbacks.</p><p><h3 class="anchor" id="P72WXMdEo3Ev">Node Observer</h3></p><p>You can now specify a callback for when the observed node is destroyed.</p><p><div id="frag_cxLziqslO1gI"><ul class="nav nav-pills"><li class="active"><a href="#LuacxLziqslO1gI">Lua</a></li></ul><div class="tab-content"><div id="LuacxLziqslO1gI" class="tab-pane active"><pre><code class="lua">vrAddNodeObserver(&quot;myObserver&quot;,
  function(node) print(&quot;node property changed&quot;) end,
  vrTreeRoot().Scenes.A,
  nil,
  function(node) print(&quot;node destroying&quot;) end
)
</code></pre></div>
</div></div><h3 class="anchor" id="X7fWeKNS8wmL">MetaNode Observer</h3></p><p>You can now specify callbacks for parent change, renaming, and destroying.</p><p><div id="frag_iQb1hgH1veAC"><ul class="nav nav-pills"><li class="active"><a href="#LuaiQb1hgH1veAC">Lua</a></li></ul><div class="tab-content"><div id="LuaiQb1hgH1veAC" class="tab-pane active"><pre><code class="lua">vrAddMetaNodeObserver(&quot;myObserver&quot;,
  function(meta, node) print(&quot;node instance created&quot;) end,
  &quot;Assembly&quot;,
  nil,
  function(meta, node, old, new) print(&quot;node parent changed from old to new&quot;) end,
  function(meta, node) print(&quot;node instance renamed&quot;) end,
  function(meta, node) print(&quot;node instance destroying&quot;) end
)
</code></pre></div>
</div></div></p><hr/><div class="row footer-nav footer-links"><div class="col-sm-4"><p><span class="fas fa-arrow-circle-left" aria-hidden="true"></span>&nbsp;<a href="v13x_200_lua_co.html">Lua Event Coroutines</a></p></div><div class="col-sm-4 col-sm-offset-4"><p class="pull-right"><a href="advanced_appcommands.html">Application Commands</a>&nbsp;<span class="fas fa-arrow-circle-right" aria-hidden="true"></span></p></div></div></div><div class="col-sm-2 col-sm-pull-10 "><div class="main-search"><form id="docs-search" autocomplete="off" class="form-horizontal" accept-charset="utf-8"><div class="input-group text-border"><input name="srch-term" id="srch-term" class="form-control" type="text" placeholder="Search"></div></form></div><div id="searchResults"><div class="list-group"><p class="list-group-item">No Results.</p></div></div><div class="list-group list-group-root"><span class="list-group-item"><a href="#side_getting_started" data-toggle="collapse"><i class="fas fa-plus-square list-toggle"></i></a><a href="getting_started.html">Getting Started</a></span><div class="list-group collapse" id="side_getting_started"><span class="list-group-item"><a href="applua_intro.html">Using the Script Editor</a></span><span class="list-group-item"><a href="eventlua_intro.html">Using the Script Event System</a></span><span class="list-group-item"><a href="luaplugin_intro.html">Creating a Lua Plugin</a></span><span class="list-group-item"><a href="plugin_intro.html">Creating a Native Plugin</a></span><span class="list-group-item"><a href="plugin_wrangle_api.html">Accessing the API</a></span></div><span class="list-group-item"><a href="#side_architecture" data-toggle="collapse"><i class="fas fa-plus-square list-toggle"></i></a><a href="architecture.html">Architecture</a></span><div class="list-group collapse" id="side_architecture"><span class="list-group-item"><a href="api_diagram.html">API Diagram</a></span><span class="list-group-item"><a href="metanodes.html">Metanodes</a></span><span class="list-group-item"><a href="properties.html">Properties</a></span><span class="list-group-item"><a href="nodes.html">Nodes</a></span><span class="list-group-item"><a href="observers.html">Observers</a></span><span class="list-group-item"><a href="scenegraph.html">Scene Graph</a></span><span class="list-group-item"><a href="plugin_directories.html">Plugin Search Paths</a></span></div><span class="list-group-item"><a href="best_practices.html">Best Practices</a></span><span class="list-group-item"><a href="#side_howto" data-toggle="collapse"><i class="fas fa-plus-square list-toggle"></i></a><a href="howto.html">How To</a></span><div class="list-group collapse" id="side_howto"><span class="list-group-item"><a href="#side_howto_lua" data-toggle="collapse"><i class="fas fa-plus-square list-toggle"></i></a><a href="howto_lua.html">Scripts</a></span><div class="list-group collapse" id="side_howto_lua"><span class="list-group-item"><a href="lua_assembly_howto.html">Work with Assembly Nodes</a></span><span class="list-group-item"><a href="lua_visual_howto.html">Work with Visual Nodes</a></span><span class="list-group-item"><a href="lua_light_howto.html">Work with Light Nodes</a></span><span class="list-group-item"><a href="lua_material_howto.html">Work with Material Nodes</a></span><span class="list-group-item"><a href="lua_lodgeo_howto.html">Work with Level of Detail and GeoGroup Nodes</a></span><span class="list-group-item"><a href="lua_sequence_howto.html">Work with Sequence Nodes</a></span><span class="list-group-item"><a href="lua_audio_howto.html">Work with Audio Nodes</a></span><span class="list-group-item"><a href="lua_video_howto.html">Work with Movie Nodes</a></span><span class="list-group-item"><a href="lua_metadata_howto.html">Work with Metadata and Attribute Nodes</a></span><span class="list-group-item"><a href="lua_settings_howto.html">Work with Settings Nodes</a></span><span class="list-group-item"><a href="lua_observers_howto.html">Work with Observers</a></span></div><span class="list-group-item"><a href="#side_howto_plugins" data-toggle="collapse"><i class="fas fa-plus-square list-toggle"></i></a><a href="howto_plugins.html">Plugins</a></span><div class="list-group collapse" id="side_howto_plugins"><span class="list-group-item"><a href="importer_howto.html">Provide a Data Importer</a></span><span class="list-group-item"><a href="exporter_howto.html">Provide a Data Exporter</a></span><span class="list-group-item"><a href="context_menu_howto.html">Add a Context Menu</a></span><span class="list-group-item"><a href="ffi_howto.html">Use the Foreign Function Interface (FFI)</a></span><span class="list-group-item"><a href="luafunc_howto.html">Provide a Lua Function</a></span><span class="list-group-item"><a href="define_metanode_howto.html">Define a Custom MetaNode</a></span><span class="list-group-item"><a href="update_howto.html">Implement an Update Function</a></span><span class="list-group-item"><a href="observer_howto.html">Implement an Observer</a></span><span class="list-group-item"><a href="logging_howto.html">Write to the Application Log</a></span><span class="list-group-item"><a href="dialog_howto.html">Present a Modal Dialog</a></span><span class="list-group-item"><a href="progress_howto.html">Update the Loading Screen</a></span></div></div><span class="list-group-item"><a href="#side_advanced" data-toggle="collapse"><i class="fas fa-plus-square list-toggle"></i></a><a href="advanced.html">Advanced Topics</a></span><div class="list-group collapse" id="side_advanced"><span class="list-group-item"><a href="advanced_appcommands.html">Application Commands</a></span><span class="list-group-item"><a href="advanced_semantics.html">Semantics</a></span><span class="list-group-item"><a href="advanced_metanode_versioning.html">Metanode Versioning</a></span><span class="list-group-item"><a href="dynamic_loading.html">Enabling/Disabling Plugins at Runtime</a></span><span class="list-group-item"><a href="lua_coroutines.html">Coroutines in Lua Plugins</a></span><span class="list-group-item"><a href="lua_odbc.html">Using LuaSQL for ODBC Connections</a></span><span class="list-group-item"><a href="lua_com.html">Reference External Data Using the COM</a></span><span class="list-group-item"><a href="terminating_long_scripts.html">Terminating Long Scripts</a></span><span class="list-group-item"><a href="plugin_depends.html">Plugin Dependencies</a></span><span class="list-group-item"><a href="surface_shader_intro.html">Writing Surface Shaders</a></span><span class="list-group-item"><a href="view_shader_intro.html">Writing View Shaders</a></span></div><span class="list-group-item show-path"><a href="#side_changes" data-toggle="collapse"><i class="fas fa-minus-square list-toggle"></i></a><a href="changes.html">Changelog</a></span><div class="list-group collapse in" id="side_changes"><span class="list-group-item"><a href="v2023_2_to_v2024_1.html">New in 2024.1</a></span><span class="list-group-item"><a href="v2023_1_to_v2023_2.html">New in 2023.2</a></span><span class="list-group-item"><a href="v2021_2_to_v2021_3.html">New in 2021.3</a></span><span class="list-group-item"><a href="v2021_1_to_v2021_2.html">New in 2021.2</a></span><span class="list-group-item"><a href="v2020_2_to_v2021_1.html">New in 2021.1</a></span><span class="list-group-item"><a href="v2020_1_to_v2020_2.html">New in 2020.2</a></span><span class="list-group-item"><a href="v2019_3_to_v2020_1.html">New in 2020.1</a></span><span class="list-group-item"><a href="v2019_2_to_v2019_3.html">New in 2019.3</a></span><span class="list-group-item"><a href="v22_to_v2019_2.html">New in 2019.2</a></span><span class="list-group-item"><a href="v21_to_v22.html">New in 2.2.0</a></span><span class="list-group-item"><a href="v20_to_v21.html">New in 2.1.0</a></span><span class="list-group-item show-path"><a href="#side_v13x_to_v2" data-toggle="collapse"><i class="fas fa-minus-square list-toggle"></i></a><a href="v13x_to_v2.html">New in 2.0.0</a></span><div class="list-group collapse in" id="side_v13x_to_v2"><span class="list-group-item"><a href="v13x_200_pivots.html">Pivot API Changes</a></span><span class="list-group-item"><a href="v13x_200_lua_co.html">Lua Event Coroutines</a></span><span class="list-group-item show-path"><a href="v13x_200_lua_observers.html">Lua Observers</a></span></div></div><span class="list-group-item"><a href="namespacevrtree.html">vrtree</a></span><span class="list-group-item"><a href="namespacevrtree__cpp.html">vrtree_cpp</a></span><span class="list-group-item"><a href="namespacevt_core.html">vtCore</a></span><span class="list-group-item"><a href="group__api__core.html">Core</a></span><span class="list-group-item"><a href="group__api__ffi.html">Foreign Function Interface</a></span><span class="list-group-item"><a href="#side_group__api__metanodes" data-toggle="collapse"><i class="fas fa-plus-square list-toggle"></i></a><a href="group__api__metanodes.html">Metanodes</a></span><div class="list-group collapse" id="side_group__api__metanodes"><span class="list-group-item"><a href="group__api__metanodes__general.html">General</a></span><span class="list-group-item"><a href="group__api__metanodes__properties.html">Properties</a></span><span class="list-group-item"><a href="group__api__metanodes__semantics.html">Semantics and Hints</a></span><span class="list-group-item"><a href="group__api__metadefs.html">Metanode Structure Definitions</a></span></div><span class="list-group-item"><a href="group__api__migrations.html">Migrations</a></span><span class="list-group-item"><a href="group__api__observer.html">Observers</a></span><span class="list-group-item"><a href="group__api__properties.html">Properties</a></span><span class="list-group-item"><a href="group__api__settings.html">Settings</a></span><span class="list-group-item"><a href="group__api__tree.html">Tree</a></span><span class="list-group-item"><a href="group__api__utils.html">Utilities</a></span><span class="list-group-item"><a href="#side_group__api__defs" data-toggle="collapse"><i class="fas fa-plus-square list-toggle"></i></a><a href="group__api__defs.html">API Definitions</a></span><div class="list-group collapse" id="side_group__api__defs"><span class="list-group-item"><a href="group__api__types.html">Types</a></span><span class="list-group-item"><a href="group__api__proto.html">Function Prototypes</a></span><span class="list-group-item"><a href="group__api__flags.html">Flags</a></span><span class="list-group-item"><a href="group__api__io__flags.html">Save/Load Tree I/O Flags</a></span><span class="list-group-item"><a href="group__api__builder__flags.html">Build Filter flags</a></span><span class="list-group-item"><a href="group__api__loggingmask.html">Logging masks</a></span><span class="list-group-item"><a href="group__api__errors.html">Error codes</a></span></div><span class="list-group-item"><a href="group__api__exchange.html">VR Exchange</a></span><span class="list-group-item"><a href="#side_group__api__plugins" data-toggle="collapse"><i class="fas fa-plus-square list-toggle"></i></a><a href="group__api__plugins.html">Plugins</a></span><div class="list-group collapse" id="side_group__api__plugins"><span class="list-group-item"><a href="group__api__plugin__interface.html">Plugin Interface</a></span><span class="list-group-item"><a href="group__api__plugin__utils.html">Plugin Utilities</a></span></div><span class="list-group-item"><a href="group__api__lua.html">Lua API</a></span></div></div>
</div></div></body></html>